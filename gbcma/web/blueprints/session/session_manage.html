{% extends "general.html" %}

{% block body %}
{% import "session_view.html" as v %}

<script src="/static/session_controller.js"></script>
<script src="/static/session_manage_controller.js"></script>

{{ v.view() }}

<script id="session-key" type="text">
{{session._id}}
</script>

<script id="stage-template" type="text/x-handlebars-template">
    {% raw %}
    {{# if proposal }}
    <div class="panel panel-default">
        <div class="panel-heading">Current proposal ({{progress.index}}/{{progress.total}})</div>
        <div class="panel-body">
            <h1>{{ proposal.title }}</h1>
            <p>{{ trimString proposal.content 512 }}</p>
        </div>
    </div>
    {{/if}}

    {{# ifEqual stage.type "voting" }}
    <div class="panel panel-default">
        <div class="panel-heading">Votes ({{votes.progress.voted}} of {{votes.progress.total}})</div>
        <div class="panel-body">
            <div class="progress">
                <div class="progress-bar progress-bar-success" style="width: {{votes.progress.yes_p}}%">
                    {{votes.progress.yes}} ({{votes.progress.yes_p}}%)
                </div>
                <div class="progress-bar progress-bar-warning" style="width: {{votes.progress.unknown_p}}%">
                    {{votes.progress.unknown}} ({{votes.progress.unknown_p}}%)
                </div>
                <div class="progress-bar progress-bar-danger" style="width: {{votes.progress.no_p}}%">
                    {{votes.progress.no}} ({{votes.progress.no_p}}%)
                </div>
            </div>

            <center>
                {{#each votes.roles}}
                <span class="label label-default">{{@key}}: {{this.yes}}/{{this.no}}/{{this.undecided}}</span>
                {{/each}}
            </center>
        </div>
    </div>
    {{/ifEqual}}

    {{# ifEqual stage.type "commenting" }}
    <div class="panel panel-default">
        <div class="panel-heading">Comments</div>
        <div class="panel-body">
            {{#each comments}}
            <div class="media">
                <div class="media-left media-top">
                    <span class="glyphicon {{thumbsIcon type}}" aria-hidden="true"></span>
                </div>

                <div class="media-body">
                    <h4 class="media-heading">{{user}}</h4>
                    {{#if quote}}<blockquote>{{quote}}</blockquote>{{/if}}
                    {{content}}
                </div>
            </div>
            {{else}}
                No comments yet
            {{/each}}
        </div>
    </div>
    {{/ifEqual}}

    {{# ifEqual stage.type "closed" }}
    <div class="panel panel-default">
        <div class="panel-heading">Session is about to end</div>
        <div class="panel-body">
            <h1>All proposals have been reviewed.</h1>
            <a href="#" class="btn btn-danger run-close">Close session</a>
        </div>
    </div>
    {{/ifEqual}}
    {% endraw %}
</script>
{% endblock %}


{% block footer %}
<footer class="footer">
    <div class="container">
        <a href="#" class="btn btn-default change-stage" data-value="-1">Previous</a>
        <a href="#" class="btn btn-primary change-stage" data-value="1">Next</a>
        <a href="#" class="btn btn-danger run-close">Close</a>
    </div>
</footer>
{% endblock %}

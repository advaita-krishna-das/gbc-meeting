{%raw%}

{{#if (not private) }}
<div class="well well-sm">
    <a href="#comment-add-box">Add comment</a>
</div>
{{/if}}

{{!-- Hide the entire block if comments are private,
      but show it for user with 'comment.manage' permission --}}

{{#if (or (not private) (has user.permissions "comment.manage"))}}
<div class="panel panel-default">
    <div class="panel-heading">
        Comments

        {{!-- Show "private" checkbox if user has
              appropriate permissions --}}
        {{#ifHas user.permissions "comment.manage"}}
        <div class="pull-right">
            <label><input id="comment-private" type="checkbox" {{#if private}}checked{{/if}}> Private</label>
        </div>
        {{/ifHas}}
    </div>


    {{! Render each comment }}
    <div class="panel-body">

        {{! Filter box }}
        <div id="comment-filter" class="well well-sm">
            <div>
                <div class="checkbox-inline">
                    <label class="checkbox-inline"><input type="checkbox" class="type" value="plus" checked>Plus</label>
                </div>
                <div class="checkbox-inline">
                    <label class="checkbox-inline"><input type="checkbox" class="type" value="minus" checked>Minus</label>
                </div>
                <div class="checkbox-inline">
                    <label class="checkbox-inline"><input type="checkbox" class="type" value="info" checked>Info</label>
                </div>
            </div>

            <div>
                {{#each roles}}
                <div class="checkbox-inline">
                    <label class="checkbox-inline"><input type="checkbox" class="role" value="{{@this}}" checked>{{@this}}</label>
                </div>
                {{/each}}
            </div>
        </div>

        <div id="comment-list">
        {{#each comments}}
            <div class="media" data-name="{{user}}" data-role="{{role}}" data-type="{{type}}">
                <div class="media-left media-top">
                    <span class="glyphicon {{thumbsIcon type}}" aria-hidden="true"></span>
                </div>

                <div class="media-body">
                    <h4 class="media-heading">{{user}} <small>{{role}}</small></h4>
                    {{#if quote}}<blockquote>{{quote}}</blockquote>{{/if}}
                    {{content}}
                </div>
            </div>
        {{else}}
            No comments yet
        {{/each}}
        </div>
    </div>
</div>
{{/if}}


{{#ifHas user.permissions "comment"}}
<a name="comment-add-box"></a>
<div class="panel panel-default">
    <div class="panel-heading">Add comment</div>
    <div class="panel-body">

        <div id="comment-submitted" class="alert alert-info alert-dismissible hidden fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            Your comment has been submitted.
        </div>

        <blockquote id="quotation" hidden="hidden"></blockquote>
        <textarea id="comment-message" class="form-control"
                  placeholder="Write down your PMI here. Select text from document above for a quote."></textarea>
        <div class="btn-group btn-group-sm btn-group-justified" role="group">
            <a role="button" class="comment-add btn btn-success" data-type="plus">Plus</a>
            <a role="button" class="comment-add btn btn-danger" data-type="minus">Minus</a>
            <a role="button" class="comment-add btn btn-info" data-type="info">Info</a>
        </div>
    </div>
</div>
{{/ifHas}}

{%endraw%}
{%raw%}

{{#ifHas user.permissions "comment"}}
{{#if (not private) }}
<div class="well well-sm">
    <a href="#comment-add-box">Add comment</a>
</div>
{{/if}}
{{/ifHas}}

{{!-- Hide the entire block if comments are private,
      but show it for user with 'comment.manage' permission --}}

{{#if (or (not private) (has user.permissions "comment.manage"))}}
<div class="panel panel-default">
    <div class="panel-heading">
        Comments

        {{!-- Show "private" checkbox if user has
              appropriate permissions --}}
        {{#ifHas user.permissions "comment.manage"}}
        <div class="pull-right">
            <label><input id="comment-private" type="checkbox" {{#if private}}checked{{/if}}> Private</label>
        </div>
        {{/ifHas}}
    </div>


    {{! Render each comment }}
    <div class="panel-body">

        {{! Filter box }}
        <form id="comment-filter" class="form-horizontal well well-sm">
            <div class="form-group">
                <label for="comment-filter-type" class="col-sm-2 control-label">Types:</label>
                <div class="col-sm-10">
                    <select id="comment-filter-type" class="selectpicker form-control" multiple>
                        <option value="plus" selected>Plus</option>
                        <option value="minus" selected>Minus</option>
                        <option value="info" selected>Info</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="comment-filter-role" class="col-sm-2 control-label">Roles:</label>
                <div class="col-sm-10">
                    <select id="comment-filter-role" class="selectpicker form-control" multiple>
                        {{#each roles}}
                        <option value="{{@this}}" selected>{{@this}}</option>
                        {{/each}}
                    </select>
                </div>
            </div>
        </form>

        <div id="comment-list">
        {{#each comments}}
            <div class="media" data-name="{{user}}" data-role="{{role}}" data-type="{{type}}">
                <div class="media-left media-top">
                    <span class="glyphicon {{thumbsIcon type}}" aria-hidden="true"></span>
                </div>

                <div class="media-body">
                    <h4 class="media-heading">{{user}} <small>{{role}}</small></h4>
                    {{#if quote}}<blockquote>{{quote}}</blockquote>{{/if}}
                    {{content}}
                </div>
            </div>
        {{else}}
            No comments yet
        {{/each}}
        </div>
    </div>
</div>
{{/if}}


{{#ifHas user.permissions "comment"}}
<a name="comment-add-box"></a>
<div class="panel panel-default">
    <div class="panel-heading">Add comment</div>
    <div class="panel-body">

        <div id="comment-submitted" class="alert alert-info alert-dismissible hidden fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            Your comment has been submitted.
        </div>

        <blockquote id="quotation" hidden="hidden"></blockquote>
        <textarea id="comment-message" class="form-control"
                  placeholder="Write down your PMI here. Select text from document above for a quote."></textarea>
        <div class="row">
            <div class="col-sm-4">
                <select id="comment-type" class="form-control">
                    <option value="plus">Plus</option>
                    <option value="minus">Minus</option>
                    <option value="info">Info</option>
                </select>
            </div>
            <div class="col-sm-8">
                <button class="comment-add form-control btn-success">Send</button>
            </div>
        </div>
    </div>
</div>
{{/ifHas}}

{%endraw%}